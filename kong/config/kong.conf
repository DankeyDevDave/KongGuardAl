# Kong Gateway Configuration for Kong Guard AI
# Development-friendly settings with custom plugin support

# Basic settings
prefix = /usr/local/kong
log_level = info
plugins = bundled,kong-guard-ai

# Database settings (for development - using Postgres)
database = postgres
pg_host = kong-database
pg_port = 5432
pg_database = kong
pg_user = kong
pg_password = kongpass

# Alternative: DB-less mode for simpler development
# database = off
# declarative_config = /etc/kong/kong.yml

# Network settings
proxy_listen = 0.0.0.0:8000, 0.0.0.0:8443 ssl
admin_listen = 0.0.0.0:8001, 0.0.0.0:8444 ssl
admin_api_uri = http://localhost:8001

# Custom plugin settings
lua_package_path = /usr/local/share/lua/5.1/?.lua;/usr/local/share/lua/5.1/?/init.lua;/etc/kong/plugins/?.lua;/etc/kong/plugins/?/init.lua;;
lua_package_cpath = /usr/local/lib/lua/5.1/?.so;;

# Plugin loading path
plugins_dir = /etc/kong/plugins

# Logging settings
proxy_access_log = /dev/stdout
proxy_error_log = /dev/stderr
admin_access_log = /dev/stdout
admin_error_log = /dev/stderr

# Performance settings
nginx_worker_processes = auto
nginx_daemon = off

# Security settings
admin_gui_listen = off  # Disable Admin GUI for security
admin_gui_url = http://localhost:8002

# Memory settings for threat detection
mem_cache_size = 128m
nginx_http_client_body_buffer_size = 8k
nginx_http_client_max_body_size = 32m

# Custom headers for debugging
headers = Server, X-Kong-Response-Latency, X-Kong-Upstream-Latency

# SSL settings (development)
ssl_cert_default = /etc/kong/ssl/kong-default.crt
ssl_cert_key_default = /etc/kong/ssl/kong-default.key

# Clustering (for future multi-node setup)
cluster_listen = 0.0.0.0:8005
cluster_telemetry_listen = 0.0.0.0:8006

# Anonymous reports (disable for privacy)
anonymous_reports = off

# Development settings
nginx_optimizations = off
lua_ssl_verify_depth = 1

# Custom nginx template (if needed)
# nginx_kong_conf = /etc/kong/nginx-kong.conf

# Tracing (optional)
tracing_instrumentations = all
tracing_sampling_rate = 0.01
