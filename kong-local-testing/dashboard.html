<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kong Local Testing Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #003459;
            --secondary: #00A8E8;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --dark: #1F2937;
            --light: #F3F4F6;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header .subtitle {
            color: #6B7280;
            margin-top: 5px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-badge.online {
            background: var(--success);
            color: white;
        }

        .status-badge.offline {
            background: var(--danger);
            color: white;
        }

        .status-badge.loading {
            background: var(--warning);
            color: white;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .services-list {
            list-style: none;
        }

        .service-item {
            padding: 12px;
            margin-bottom: 10px;
            background: var(--light);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .service-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .service-name {
            font-weight: 600;
            color: var(--dark);
        }

        .service-url {
            color: #6B7280;
            font-size: 12px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .metric {
            text-align: center;
            padding: 15px;
            background: var(--light);
            border-radius: 8px;
        }

        .metric-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary);
        }

        .metric-label {
            color: #6B7280;
            font-size: 12px;
            margin-top: 5px;
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }

        .log-viewer {
            background: #1F2937;
            color: #10B981;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--light);
        }

        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #6B7280;
            cursor: pointer;
            font-weight: 600;
            position: relative;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: var(--primary);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary);
        }

        .endpoint-tester {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .endpoint-tester input {
            flex: 1;
            padding: 10px;
            border: 1px solid #D1D5DB;
            border-radius: 8px;
        }

        .endpoint-tester select {
            padding: 10px;
            border: 1px solid #D1D5DB;
            border-radius: 8px;
        }

        .response-viewer {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .response-viewer pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #D1FAE5;
            color: #065F46;
            border-left: 4px solid var(--success);
        }

        .alert-error {
            background: #FEE2E2;
            color: #991B1B;
            border-left: 4px solid var(--danger);
        }

        .alert-info {
            background: #DBEAFE;
            color: #1E40AF;
            border-left: 4px solid var(--secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                🔧 Kong Local Testing Environment
                <span id="main-status" class="status-badge loading">Checking...</span>
            </h1>
            <div class="subtitle">Complete Kong Gateway testing and evaluation platform</div>
        </div>

        <!-- Alerts -->
        <div id="alerts"></div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('overview')">Overview</button>
            <button class="tab" onclick="switchTab('services')">Services</button>
            <button class="tab" onclick="switchTab('testing')">Testing</button>
            <button class="tab" onclick="switchTab('monitoring')">Monitoring</button>
            <button class="tab" onclick="switchTab('configuration')">Configuration</button>
        </div>

        <!-- Tab Content -->
        <div id="overview-tab" class="tab-content">
            <div class="grid">
                <!-- Kong Status -->
                <div class="card">
                    <h2>🚀 Kong Instances</h2>
                    <ul class="services-list">
                        <li class="service-item">
                            <div>
                                <div class="service-name">Kong DB Mode</div>
                                <div class="service-url">http://localhost:8001</div>
                            </div>
                            <span id="kong-db-status" class="status-badge loading">...</span>
                        </li>
                        <li class="service-item">
                            <div>
                                <div class="service-name">Kong DB-less Mode</div>
                                <div class="service-url">http://localhost:9001</div>
                            </div>
                            <span id="kong-dbless-status" class="status-badge loading">...</span>
                        </li>
                        <li class="service-item">
                            <div>
                                <div class="service-name">Kong Manager GUI</div>
                                <div class="service-url">http://localhost:8002</div>
                            </div>
                            <span id="kong-manager-status" class="status-badge loading">...</span>
                        </li>
                    </ul>
                </div>

                <!-- Services Status -->
                <div class="card">
                    <h2>📦 Backend Services</h2>
                    <ul class="services-list">
                        <li class="service-item">
                            <div>
                                <div class="service-name">HTTPBin</div>
                                <div class="service-url">http://localhost:8080</div>
                            </div>
                            <span id="httpbin-status" class="status-badge loading">...</span>
                        </li>
                        <li class="service-item">
                            <div>
                                <div class="service-name">Echo Server</div>
                                <div class="service-url">http://localhost:8081</div>
                            </div>
                            <span id="echo-status" class="status-badge loading">...</span>
                        </li>
                        <li class="service-item">
                            <div>
                                <div class="service-name">MockBin</div>
                                <div class="service-url">http://localhost:8082</div>
                            </div>
                            <span id="mockbin-status" class="status-badge loading">...</span>
                        </li>
                    </ul>
                </div>

                <!-- Quick Stats -->
                <div class="card">
                    <h2>📊 Kong Statistics</h2>
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-value" id="services-count">-</div>
                            <div class="metric-label">Services</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="routes-count">-</div>
                            <div class="metric-label">Routes</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="plugins-count">-</div>
                            <div class="metric-label">Plugins</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value" id="consumers-count">-</div>
                            <div class="metric-label">Consumers</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <h2>⚡ Quick Actions</h2>
                    <div class="quick-actions">
                        <button class="btn btn-success" onclick="startServices()">Start All</button>
                        <button class="btn btn-danger" onclick="stopServices()">Stop All</button>
                        <button class="btn btn-warning" onclick="restartServices()">Restart</button>
                        <button class="btn btn-primary" onclick="runTests()">Run Tests</button>
                        <button class="btn btn-primary" onclick="openKongManager()">Open Manager</button>
                        <button class="btn btn-primary" onclick="viewLogs()">View Logs</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="services-tab" class="tab-content" style="display: none;">
            <div class="grid">
                <!-- Services List -->
                <div class="card">
                    <h2>📋 Configured Services</h2>
                    <div id="services-list"></div>
                    <button class="btn btn-primary" onclick="loadServices()">Refresh</button>
                    <button class="btn btn-success" onclick="addService()">Add Service</button>
                </div>

                <!-- Routes List -->
                <div class="card">
                    <h2>🛣️ Routes</h2>
                    <div id="routes-list"></div>
                    <button class="btn btn-primary" onclick="loadRoutes()">Refresh</button>
                </div>

                <!-- Plugins List -->
                <div class="card">
                    <h2>🔌 Active Plugins</h2>
                    <div id="plugins-list"></div>
                    <button class="btn btn-primary" onclick="loadPlugins()">Refresh</button>
                </div>
            </div>
        </div>

        <div id="testing-tab" class="tab-content" style="display: none;">
            <div class="grid">
                <!-- API Tester -->
                <div class="card">
                    <h2>🧪 API Endpoint Tester</h2>
                    <div class="endpoint-tester">
                        <select id="method">
                            <option>GET</option>
                            <option>POST</option>
                            <option>PUT</option>
                            <option>DELETE</option>
                            <option>PATCH</option>
                        </select>
                        <input type="text" id="endpoint" placeholder="Enter endpoint (e.g., /httpbin/get)" value="/httpbin/get">
                        <button class="btn btn-primary" onclick="testEndpoint()">Send</button>
                    </div>
                    <div class="response-viewer" id="response" style="display: none;">
                        <pre id="response-content"></pre>
                    </div>
                </div>

                <!-- Test Scenarios -->
                <div class="card">
                    <h2>🎯 Test Scenarios</h2>
                    <div class="quick-actions">
                        <button class="btn btn-primary" onclick="testScenario('basic')">Basic Tests</button>
                        <button class="btn btn-warning" onclick="testScenario('auth')">Auth Tests</button>
                        <button class="btn btn-warning" onclick="testScenario('ratelimit')">Rate Limit</button>
                        <button class="btn btn-danger" onclick="testScenario('load')">Load Test</button>
                        <button class="btn btn-success" onclick="testScenario('all')">Run All</button>
                    </div>
                    <div class="log-viewer" id="test-output"></div>
                </div>
            </div>
        </div>

        <div id="monitoring-tab" class="tab-content" style="display: none;">
            <div class="grid">
                <!-- Monitoring Links -->
                <div class="card">
                    <h2>📈 Monitoring Tools</h2>
                    <ul class="services-list">
                        <li class="service-item" onclick="window.open('http://localhost:9090', '_blank')">
                            <div>
                                <div class="service-name">Prometheus</div>
                                <div class="service-url">Metrics collection</div>
                            </div>
                            <span class="status-badge online">→</span>
                        </li>
                        <li class="service-item" onclick="window.open('http://localhost:3000', '_blank')">
                            <div>
                                <div class="service-name">Grafana</div>
                                <div class="service-url">Dashboards (admin/admin123)</div>
                            </div>
                            <span class="status-badge online">→</span>
                        </li>
                        <li class="service-item" onclick="window.open('http://localhost:5050', '_blank')">
                            <div>
                                <div class="service-name">pgAdmin</div>
                                <div class="service-url">Database management</div>
                            </div>
                            <span class="status-badge online">→</span>
                        </li>
                        <li class="service-item" onclick="window.open('http://localhost:8083', '_blank')">
                            <div>
                                <div class="service-name">Redis Commander</div>
                                <div class="service-url">Cache management</div>
                            </div>
                            <span class="status-badge online">→</span>
                        </li>
                    </ul>
                </div>

                <!-- Live Logs -->
                <div class="card">
                    <h2>📝 Live Logs</h2>
                    <select id="log-service" onchange="switchLogs()">
                        <option value="kong-db">Kong DB Mode</option>
                        <option value="kong-dbless">Kong DB-less</option>
                        <option value="httpbin">HTTPBin</option>
                        <option value="redis">Redis</option>
                    </select>
                    <div class="log-viewer" id="live-logs"></div>
                </div>
            </div>
        </div>

        <div id="configuration-tab" class="tab-content" style="display: none;">
            <div class="card">
                <h2>⚙️ Configuration Management</h2>
                <div class="quick-actions">
                    <button class="btn btn-primary" onclick="exportConfig()">Export Config</button>
                    <button class="btn btn-primary" onclick="importConfig()">Import Config</button>
                    <button class="btn btn-warning" onclick="resetConfig()">Reset to Default</button>
                    <button class="btn btn-success" onclick="applyConfig()">Apply Changes</button>
                </div>
                <textarea id="config-editor" style="width: 100%; height: 400px; margin-top: 20px; padding: 10px; font-family: monospace;"></textarea>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const KONG_ADMIN = 'http://localhost:8001';
        const KONG_DBLESS_ADMIN = 'http://localhost:9001';
        const KONG_PROXY = 'http://localhost:8000';

        // Initialize
        window.onload = function() {
            checkSystemStatus();
            loadStatistics();
            setInterval(checkSystemStatus, 30000); // Check every 30 seconds
            setInterval(loadStatistics, 10000); // Update stats every 10 seconds
        };

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });

            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').style.display = 'block';

            // Add active class to clicked tab
            event.target.classList.add('active');

            // Load tab-specific data
            if (tabName === 'services') {
                loadServices();
                loadRoutes();
                loadPlugins();
            }
        }

        // Check system status
        async function checkSystemStatus() {
            // Check Kong DB mode
            checkService(KONG_ADMIN, 'kong-db-status');

            // Check Kong DB-less mode
            checkService(KONG_DBLESS_ADMIN, 'kong-dbless-status');

            // Check Kong Manager
            checkService('http://localhost:8002', 'kong-manager-status');

            // Check backend services
            checkService('http://localhost:8080', 'httpbin-status');
            checkService('http://localhost:8081', 'echo-status');
            checkService('http://localhost:8082', 'mockbin-status');

            // Update main status
            updateMainStatus();
        }

        async function checkService(url, elementId) {
            const element = document.getElementById(elementId);
            if (!element) return;

            try {
                const response = await fetch(url, {
                    method: 'GET',
                    mode: 'no-cors',
                    signal: AbortSignal.timeout(3000)
                });

                element.textContent = 'Online';
                element.className = 'status-badge online';
            } catch (error) {
                element.textContent = 'Offline';
                element.className = 'status-badge offline';
            }
        }

        function updateMainStatus() {
            const kongStatus = document.getElementById('kong-db-status');
            const mainStatus = document.getElementById('main-status');

            if (kongStatus && kongStatus.textContent === 'Online') {
                mainStatus.textContent = 'RUNNING';
                mainStatus.className = 'status-badge online';
            } else {
                mainStatus.textContent = 'STOPPED';
                mainStatus.className = 'status-badge offline';
            }
        }

        // Load Kong statistics
        async function loadStatistics() {
            try {
                // Services count
                const services = await fetch(KONG_ADMIN + '/services').then(r => r.json());
                document.getElementById('services-count').textContent = services.data ? services.data.length : '0';

                // Routes count
                const routes = await fetch(KONG_ADMIN + '/routes').then(r => r.json());
                document.getElementById('routes-count').textContent = routes.data ? routes.data.length : '0';

                // Plugins count
                const plugins = await fetch(KONG_ADMIN + '/plugins').then(r => r.json());
                document.getElementById('plugins-count').textContent = plugins.data ? plugins.data.length : '0';

                // Consumers count
                const consumers = await fetch(KONG_ADMIN + '/consumers').then(r => r.json());
                document.getElementById('consumers-count').textContent = consumers.data ? consumers.data.length : '0';
            } catch (error) {
                console.error('Failed to load statistics:', error);
            }
        }

        // Load services
        async function loadServices() {
            try {
                const response = await fetch(KONG_ADMIN + '/services');
                const data = await response.json();
                const list = document.getElementById('services-list');

                if (data.data && data.data.length > 0) {
                    list.innerHTML = data.data.map(service => `
                        <div class="service-item">
                            <div>
                                <div class="service-name">${service.name}</div>
                                <div class="service-url">${service.host}:${service.port}</div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    list.innerHTML = '<p>No services configured</p>';
                }
            } catch (error) {
                document.getElementById('services-list').innerHTML = '<p>Failed to load services</p>';
            }
        }

        // Load routes
        async function loadRoutes() {
            try {
                const response = await fetch(KONG_ADMIN + '/routes');
                const data = await response.json();
                const list = document.getElementById('routes-list');

                if (data.data && data.data.length > 0) {
                    list.innerHTML = data.data.map(route => `
                        <div class="service-item">
                            <div>
                                <div class="service-name">${route.name || 'Unnamed'}</div>
                                <div class="service-url">${route.paths ? route.paths.join(', ') : 'No paths'}</div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    list.innerHTML = '<p>No routes configured</p>';
                }
            } catch (error) {
                document.getElementById('routes-list').innerHTML = '<p>Failed to load routes</p>';
            }
        }

        // Load plugins
        async function loadPlugins() {
            try {
                const response = await fetch(KONG_ADMIN + '/plugins');
                const data = await response.json();
                const list = document.getElementById('plugins-list');

                if (data.data && data.data.length > 0) {
                    list.innerHTML = data.data.map(plugin => `
                        <div class="service-item">
                            <div>
                                <div class="service-name">${plugin.name}</div>
                                <div class="service-url">${plugin.enabled ? 'Enabled' : 'Disabled'}</div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    list.innerHTML = '<p>No plugins configured</p>';
                }
            } catch (error) {
                document.getElementById('plugins-list').innerHTML = '<p>Failed to load plugins</p>';
            }
        }

        // Test endpoint
        async function testEndpoint() {
            const method = document.getElementById('method').value;
            const endpoint = document.getElementById('endpoint').value;
            const responseDiv = document.getElementById('response');
            const responseContent = document.getElementById('response-content');

            responseDiv.style.display = 'block';
            responseContent.textContent = 'Sending request...';

            try {
                const response = await fetch(KONG_PROXY + endpoint, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.text();
                let formattedData;

                try {
                    formattedData = JSON.stringify(JSON.parse(data), null, 2);
                } catch {
                    formattedData = data;
                }

                responseContent.textContent = `Status: ${response.status} ${response.statusText}\n\n${formattedData}`;
            } catch (error) {
                responseContent.textContent = `Error: ${error.message}`;
            }
        }

        // Quick actions
        function startServices() {
            showAlert('info', 'Starting services... Run: ./scripts/kong-manager.sh start');
        }

        function stopServices() {
            showAlert('info', 'Stopping services... Run: ./scripts/kong-manager.sh stop');
        }

        function restartServices() {
            showAlert('info', 'Restarting services... Run: ./scripts/kong-manager.sh stop && ./scripts/kong-manager.sh start');
        }

        function runTests() {
            showAlert('info', 'Running tests... Run: ./scripts/api-tests.sh');
        }

        function openKongManager() {
            window.open('http://localhost:8002', '_blank');
        }

        function viewLogs() {
            showAlert('info', 'To view logs, run: docker-compose logs -f kong-db');
        }

        function testScenario(scenario) {
            const output = document.getElementById('test-output');
            output.textContent = `Running ${scenario} tests...\nExecute: ./scripts/api-tests.sh ${scenario}`;
        }

        // Show alert
        function showAlert(type, message) {
            const alertsDiv = document.getElementById('alerts');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alertsDiv.appendChild(alert);

            setTimeout(() => {
                alert.remove();
            }, 5000);
        }
    </script>
</body>
</html>
